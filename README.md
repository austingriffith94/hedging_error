# hedging_error
Hedging Error and Profit and Loss Calculations
    This series of classes and code solves for the profit and loss and cumulative hedging error of a set of stock prices and options. In this case, there is are csvs provided that have historical values of the interest rates and the sec prices of Alphabet/Google stocks. Another csv provided has historical option prices for Alphabet/Google.

# functions explanation:
## stdnormalcdf.h and stdnormalcdf.cpp:
    This is the class that solves for the standard normal approximation of an input value. The class is initialized with only a single value. In this case, it will often be the d1 value from the Black-Scholes class. The class uses a single function, and a private variable created from the initialized input value. When the Nx function is run, variables of a1-a5, which are constant values used in the approximation of the Z value, are created. Also, a B value is created. It simply represents 1/√2π, and is created to remove the long, messy pi value from future equations. Then, the equation solves for the standard normal approximation of the input value. If the value was negative, it adjusts accordingly. The class can approximate the standard normal distribution of a value to within 6 decimal places.

## black.h and black.cpp
    These files hold the Black-Scholes class. The private variables are simply the initializer values of time to expiration, strike price, spot price, interest rate and volatility. The d1 value and d2 value are public, and solved immediately upon initialization of the class. This was created due to the need of the d1 in many other applications in other functions. It also saved from adding an additional function inside of the class that created a d1 value, and makes running the functions of the class much easier.
    The functions in the black file are the value of the put and call option, and the delta value, used in the hedging error. The put and call option are simply the Black-Scholes formula, which outputs the value of a put or call option. In the calculation, the stdnormalcdf.h function is used to determine the standard normal approximation of d1 and d2. These values are then used with the initialized private variables to get the call or put value.
    The delta value for a call or put option are very similar. These two function are the absolute value of the standard normal approximation of d1 multiplied by the exponential of dividends and time to expiration. If dividends are zero, this can simply be viewed as the normal approximation of d1 for call options.

## reader.h and reader.cpp
    The reader files are meant to read the csv, and hold the vector read locally to prevent clutter in the main file. Public variables include vectors hold the values from the interest, sec_GOOG, and op_GOOG csv files. There is also the calculated days to expiration and days to trade, though the latter is not used in the application of this assignment. Among the functions, each one serves a purpose of reading the csv files or getting desired values from the vectors.
    The interest_input function using a simple while loop to read an interest file while the csv is open. It takes a line from the csv, and taking the string from the start of the line till the first comma, not including the comma. It then looks for a “-“, which is present in all date values, but not the header. The following if statement ensures that so long as it is a date and not the header, it will read the date value and rate value (which is transferred from string to double), and update the respective public vector with the value. This same logic is used in the sec_input class function, only it reads an sec csv file.
    The op_input function reads an op csv. It starts with a getline command before the while loop to skip the header of the file. Once in the while loop, it takes a line from the csv (now in the body, not header). The line is then passed into a string stream, and getline functions are used to parse the data by comma, with each iteration of getline getting a different variable. Once all the variables are collected and the csv line has been passed through, the public vectors for the op values are updated, and changed to doubles when necessary.
    The trimmer function is used to clean the vectors read from the csv using an input of start, end and expiration dates, and outputs an interest rate, price and date vector that goes from the start to end dates. The loop parses through the sec date vector, looking for a date that matches the start, end and expiration date. If that value is found, it gives the location of that date value, which is then used (once the for loop is complete) to section off the sec price and interest rate vectors from the start to the end values (since the sec and interest rate csv files are the same length, the start and end location are the same for each of their vectors. For the expiration date, there is the issue of it often times falling on weekends. In order to find the days to expiration, a nested if else statement was used to find when the month substrings matched. The day value was then changed to a double. If the day values matched, then that is the expiration location. If the day from the date vector jumped above the expiration day, then that is the expiration location.
    For the bid and offer functions, a date string, expiration spring, strike price and option type are input. A for loop runs through the op vectors, and compares the input values for the function. When all the values match, that is the location of the bid and offer values, which are then output. The for loop is then closed.

## hedge.h and hedge.cpp
    The hedge class is used to determine the implied volatility, delta, hedge error and profit and loss for the portfolio. The class is initialized with a price vector (from the sec file), interest vector (from the interest file), p vector (the average of the bid and offer values), dates vector, strike, expiration time, volatility, and dividends. The pass private variable is set to 1/252, the passing of a single workday. The class vectors are hedging error, delta, profit and loss, and implied volatility, which are updated in the functions built into the class.
    The volatility function is set to only run for 100 iterations, to reduce run time should the volatility not converge within the tolerance. The convergence value is set to 0.000001. A for loop is then run for size of the price vector. Then, the vega for the respective price and interest rate is calculated, as well as the guessed sigma value (in this case, 0.24, which was relatively close to most estimated volatilities reducing computation time). Once the convergence value is met, the sigma value is added, and expiration value is updated.
    For the private variables, there are the initializer’s value of spot, strike, time to expiration, interest rate, volatility, and iterations. There are also the private vector values that hold the hedging error, profit and loss, the call price, the option price, and delta.
    In the error function, a for loop starts at 1, and continues till the iteration count (in this case 100). At the start of the loop, the price series function is called, and creates a new price using the prior price value. The black class constructor creates two versions of the class, one with the old price, loop1, and one with the new price, loop2. Then, using the loop2 constructor, the delta value of the new price is called. This new delta is set into the delta vector, and then is used to alongside the old delta to calculate the new B value. Then, hedging error and profit and loss can be calculated, and their respective vectors are updated. The call price and spot price are also updated. The time value is subtracted by a increment determined by the number of iterations, and the price, delta and B values calculated from this iteration are set as the old value for the subsequent calculation. The loop is ended, and continued until completion.

